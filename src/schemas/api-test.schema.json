{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "API Test Suite",
  "description": "Schema for API test scenario JSON files used by the Universal Test Engine",
  "type": "object",
  "required": ["suite", "tests"],
  "properties": {
    "suite": {
      "type": "string",
      "description": "Human-readable name of the test suite"
    },
    "tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Tags for filtering: smoke, regression, critical, negative, boundary"
    },
    "baseEndpoint": {
      "type": "string",
      "description": "Optional base path prepended to every test endpoint"
    },
    "setup": {
      "$ref": "#/definitions/hookStep",
      "description": "Optional request executed before the suite (e.g. login)"
    },
    "teardown": {
      "$ref": "#/definitions/hookStep",
      "description": "Optional request executed after the suite"
    },
    "tests": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/definitions/apiTestCase" }
    }
  },
  "definitions": {
    "hookStep": {
      "type": "object",
      "required": ["method", "endpoint"],
      "properties": {
        "method": { "type": "string", "enum": ["GET", "POST", "PUT", "PATCH", "DELETE"] },
        "endpoint": { "type": "string" },
        "body": {},
        "headers": { "type": "object", "additionalProperties": { "type": "string" } },
        "extractToken": {
          "type": "object",
          "properties": {
            "fromPath": { "type": "string", "description": "JSONPath-like dot notation, e.g. data.token" },
            "as": { "type": "string", "description": "Variable name to store, referenced as {{varName}}" }
          }
        }
      }
    },
    "apiTestCase": {
      "type": "object",
      "required": ["name", "method", "endpoint", "expect"],
      "properties": {
        "name": { "type": "string" },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "method": { "type": "string", "enum": ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS"] },
        "endpoint": { "type": "string" },
        "headers": { "type": "object", "additionalProperties": { "type": "string" } },
        "query": { "type": "object", "additionalProperties": { "type": "string" } },
        "body": {},
        "auth": {
          "type": "string",
          "description": "Reference to a stored variable: {{token}}"
        },
        "expect": { "$ref": "#/definitions/expectation" },
        "skip": { "type": "boolean", "default": false },
        "only": { "type": "boolean", "default": false },
        "timeout": { "type": "number" },
        "retries": { "type": "number" },
        "dataInjection": {
          "type": "object",
          "description": "Custom data to inject, accessible via {{key}} in endpoint/body"
        }
      }
    },
    "expectation": {
      "type": "object",
      "properties": {
        "status": { "type": "number" },
        "statusRange": {
          "type": "object",
          "properties": {
            "min": { "type": "number" },
            "max": { "type": "number" }
          }
        },
        "bodyContains": {
          "description": "Partial match: every key/value must appear somewhere in the response body",
          "type": "object"
        },
        "bodyExact": {
          "description": "Exact deep-equal match"
        },
        "bodySchema": {
          "description": "JSON Schema the response body must satisfy",
          "type": "object"
        },
        "bodyPath": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["path"],
            "properties": {
              "path": { "type": "string" },
              "equals": {},
              "contains": {},
              "type": { "type": "string" },
              "minLength": { "type": "number" },
              "maxLength": { "type": "number" },
              "regex": { "type": "string" }
            }
          }
        },
        "headers": { "type": "object", "additionalProperties": { "type": "string" } },
        "responseTime": { "type": "number", "description": "Max response time in ms" }
      }
    }
  }
}
